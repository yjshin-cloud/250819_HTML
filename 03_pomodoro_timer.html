<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
      }

      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        min-width: 400px;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 30px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .timer-display {
        font-size: 4rem;
        font-weight: bold;
        margin: 30px 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }

      .timer-display.work {
        color: #ff6b6b;
      }

      .timer-display.break {
        color: #4ecdc4;
      }

      .status {
        font-size: 1.2rem;
        margin: 20px 0;
        opacity: 0.9;
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin: 30px 0;
      }

      button {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 12px 24px;
        border-radius: 50px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }

      button:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      button:active {
        transform: translateY(0);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .settings {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
      }

      .setting-group {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 15px 0;
      }

      input[type="number"] {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 8px 12px;
        border-radius: 10px;
        width: 80px;
        text-align: center;
        font-size: 1rem;
      }

      input[type="number"]:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.5);
        background: rgba(255, 255, 255, 0.2);
      }

      .cycles-info {
        margin-top: 20px;
        font-size: 1.1rem;
        opacity: 0.8;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        margin: 20px 0;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #ff6b6b, #ffa500);
        border-radius: 4px;
        transition: width 1s ease;
        width: 0%;
      }

      .progress-fill.break {
        background: linear-gradient(90deg, #4ecdc4, #44a08d);
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .timer-display.pulsing {
        animation: pulse 1s infinite;
      }

      @media (max-width: 480px) {
        .container {
          margin: 20px;
          padding: 30px 20px;
          min-width: auto;
        }

        .timer-display {
          font-size: 3rem;
        }

        .controls {
          flex-direction: column;
          gap: 10px;
        }

        button {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ… ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸</h1>

      <div class="timer-display work" id="timerDisplay">25:00</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="status" id="status">ì§‘ì¤‘ ì‹œê°„</div>

      <div class="controls">
        <button id="startBtn">ì‹œì‘</button>
        <button id="pauseBtn" disabled>ì¼ì‹œì •ì§€</button>
        <button id="resetBtn">ë¦¬ì…‹</button>
      </div>

      <div class="cycles-info">
        <div>ì™„ë£Œí•œ ë½€ëª¨ë„ë¡œ: <span id="completedCycles">0</span>ê°œ</div>
      </div>

      <div class="settings">
        <h3 style="margin-bottom: 20px">âš™ï¸ ì„¤ì •</h3>
        <div class="setting-group">
          <label>ì§‘ì¤‘ ì‹œê°„ (ë¶„):</label>
          <input type="number" id="workMinutes" value="25" min="1" max="60" />
        </div>
        <div class="setting-group">
          <label>ì§§ì€ íœ´ì‹ (ë¶„):</label>
          <input
            type="number"
            id="shortBreakMinutes"
            value="5"
            min="1"
            max="15"
          />
        </div>
        <div class="setting-group">
          <label>ê¸´ íœ´ì‹ (ë¶„):</label>
          <input
            type="number"
            id="longBreakMinutes"
            value="15"
            min="10"
            max="30"
          />
        </div>
      </div>
    </div>

    <script>
      // íƒ€ì´ë¨¸ ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜ë“¤
      let timerInterval = null; // setInterval ì°¸ì¡°
      let isRunning = false; // íƒ€ì´ë¨¸ ì‹¤í–‰ ìƒíƒœ
      let currentMode = "work"; // í˜„ì¬ ëª¨ë“œ: 'work', 'short-break', 'long-break'
      let timeLeft = 25 * 60; // ë‚¨ì€ ì‹œê°„ (ì´ˆ)
      let completedCycles = 0; // ì™„ë£Œí•œ ë½€ëª¨ë„ë¡œ ìˆ˜
      let totalTime = 25 * 60; // ì „ì²´ ì‹œê°„ (ì§„í–‰ë¥  ê³„ì‚°ìš©)

      // DOM ìš”ì†Œ ì°¸ì¡°
      const timerDisplay = document.getElementById("timerDisplay");
      const progressFill = document.getElementById("progressFill");
      const status = document.getElementById("status");
      const startBtn = document.getElementById("startBtn");
      const pauseBtn = document.getElementById("pauseBtn");
      const resetBtn = document.getElementById("resetBtn");
      const completedCyclesSpan = document.getElementById("completedCycles");
      const workMinutesInput = document.getElementById("workMinutes");
      const shortBreakMinutesInput =
        document.getElementById("shortBreakMinutes");
      const longBreakMinutesInput = document.getElementById("longBreakMinutes");

      // ì‹œê°„ì„ MM:SS í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
      function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${minutes.toString().padStart(2, "0")}:${secs
          .toString()
          .padStart(2, "0")}`;
      }

      // í™”ë©´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateDisplay() {
        timerDisplay.textContent = formatTime(timeLeft);

        // ì§„í–‰ë¥  ê³„ì‚° ë° ì—…ë°ì´íŠ¸
        const progress = ((totalTime - timeLeft) / totalTime) * 100;
        progressFill.style.width = `${progress}%`;

        // ì™„ë£Œí•œ ë½€ëª¨ë„ë¡œ ìˆ˜ ì—…ë°ì´íŠ¸
        completedCyclesSpan.textContent = completedCycles;
      }

      // ëª¨ë“œ ë³€ê²½ í•¨ìˆ˜
      function switchMode(mode) {
        currentMode = mode;

        // ëª¨ë“œì— ë”°ë¥¸ ì‹œê°„ ì„¤ì •
        if (mode === "work") {
          timeLeft = parseInt(workMinutesInput.value) * 60;
          status.textContent = "ì§‘ì¤‘ ì‹œê°„";
          timerDisplay.className = "timer-display work";
          progressFill.className = "progress-fill";
        } else if (mode === "short-break") {
          timeLeft = parseInt(shortBreakMinutesInput.value) * 60;
          status.textContent = "ì§§ì€ íœ´ì‹";
          timerDisplay.className = "timer-display break";
          progressFill.className = "progress-fill break";
        } else if (mode === "long-break") {
          timeLeft = parseInt(longBreakMinutesInput.value) * 60;
          status.textContent = "ê¸´ íœ´ì‹";
          timerDisplay.className = "timer-display break";
          progressFill.className = "progress-fill break";
        }

        totalTime = timeLeft; // ì§„í–‰ë¥  ê³„ì‚°ì„ ìœ„í•œ ì „ì²´ ì‹œê°„ ì €ì¥
        updateDisplay();
      }

      // íƒ€ì´ë¨¸ ì‹œì‘ í•¨ìˆ˜
      function startTimer() {
        if (isRunning) return; // ì´ë¯¸ ì‹¤í–‰ ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€

        isRunning = true;
        startBtn.disabled = true; // ì‹œì‘ ë²„íŠ¼ ë¹„í™œì„±í™”
        pauseBtn.disabled = false; // ì¼ì‹œì •ì§€ ë²„íŠ¼ í™œì„±í™”

        // íƒ€ì´ë¨¸ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
        timerDisplay.classList.add("pulsing");

        // 1ì´ˆë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” íƒ€ì´ë¨¸
        timerInterval = setInterval(() => {
          timeLeft--; // 1ì´ˆ ê°ì†Œ
          updateDisplay();

          // ì‹œê°„ì´ ë‹¤ ë˜ì—ˆì„ ë•Œ
          if (timeLeft <= 0) {
            completeCurrentMode();
          }
        }, 1000);
      }

      // íƒ€ì´ë¨¸ ì¼ì‹œì •ì§€ í•¨ìˆ˜
      function pauseTimer() {
        if (!isRunning) return;

        isRunning = false;
        clearInterval(timerInterval); // íƒ€ì´ë¨¸ ì •ì§€
        timerInterval = null;

        startBtn.disabled = false; // ì‹œì‘ ë²„íŠ¼ í™œì„±í™”
        pauseBtn.disabled = true; // ì¼ì‹œì •ì§€ ë²„íŠ¼ ë¹„í™œì„±í™”

        timerDisplay.classList.remove("pulsing");
      }

      // íƒ€ì´ë¨¸ ë¦¬ì…‹ í•¨ìˆ˜
      function resetTimer() {
        pauseTimer(); // ì‹¤í–‰ ì¤‘ì´ë©´ ë¨¼ì € ì •ì§€
        switchMode(currentMode); // í˜„ì¬ ëª¨ë“œì˜ ì´ˆê¸° ì‹œê°„ìœ¼ë¡œ ë¦¬ì…‹
      }

      // í˜„ì¬ ëª¨ë“œ ì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜
      function completeCurrentMode() {
        pauseTimer();

        // ì™„ë£Œ ì•Œë¦¼ ì†Œë¦¬ (ë¸Œë¼ìš°ì € ê¸°ë³¸ ì•Œë¦¼ìŒ)
        playNotificationSound();

        if (currentMode === "work") {
          // ì§‘ì¤‘ ì‹œê°„ ì™„ë£Œ
          completedCycles++;

          // 4ë²ˆì§¸ ë½€ëª¨ë„ë¡œ ì™„ë£Œ ì‹œ ê¸´ íœ´ì‹, ì•„ë‹ˆë©´ ì§§ì€ íœ´ì‹
          if (completedCycles % 4 === 0) {
            alert("ğŸ‰ 4ë²ˆì§¸ ë½€ëª¨ë„ë¡œ ì™„ë£Œ! ê¸´ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”.");
            switchMode("long-break");
          } else {
            alert("âœ… ë½€ëª¨ë„ë¡œ ì™„ë£Œ! ì§§ì€ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”.");
            switchMode("short-break");
          }
        } else {
          // íœ´ì‹ ì‹œê°„ ì™„ë£Œ
          alert("â° íœ´ì‹ ì™„ë£Œ! ìƒˆë¡œìš´ ë½€ëª¨ë„ë¡œë¥¼ ì‹œì‘í•˜ì„¸ìš”.");
          switchMode("work");
        }

        updateDisplay();
      }

      // ì•Œë¦¼ìŒ ì¬ìƒ í•¨ìˆ˜
      function playNotificationSound() {
        // Web Audio APIë¥¼ ì‚¬ìš©í•œ ê°„ë‹¨í•œ ë¹„í”„ìŒ ìƒì„±
        const audioContext = new (window.AudioContext ||
          window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.frequency.setValueAtTime(800, audioContext.currentTime); // 800Hz ì£¼íŒŒìˆ˜
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime); // ë³¼ë¥¨

        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.2); // 0.2ì´ˆê°„ ì¬ìƒ
      }

      // ì„¤ì • ë³€ê²½ ì‹œ í˜„ì¬ ëª¨ë“œ ì‹œê°„ ì—…ë°ì´íŠ¸
      function updateCurrentModeTime() {
        if (!isRunning) {
          // ì‹¤í–‰ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ì—…ë°ì´íŠ¸
          if (currentMode === "work") {
            timeLeft = parseInt(workMinutesInput.value) * 60;
          } else if (currentMode === "short-break") {
            timeLeft = parseInt(shortBreakMinutesInput.value) * 60;
          } else if (currentMode === "long-break") {
            timeLeft = parseInt(longBreakMinutesInput.value) * 60;
          }
          totalTime = timeLeft;
          updateDisplay();
        }
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      startBtn.addEventListener("click", startTimer);
      pauseBtn.addEventListener("click", pauseTimer);
      resetBtn.addEventListener("click", resetTimer);

      // ì„¤ì • ì…ë ¥ í•„ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      workMinutesInput.addEventListener("change", updateCurrentModeTime);
      shortBreakMinutesInput.addEventListener("change", updateCurrentModeTime);
      longBreakMinutesInput.addEventListener("change", updateCurrentModeTime);

      // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì§€ì›
      document.addEventListener("keydown", (e) => {
        if (e.code === "Space") {
          e.preventDefault(); // ìŠ¤í˜ì´ìŠ¤ë°”ì˜ ê¸°ë³¸ ë™ì‘ ë°©ì§€
          if (isRunning) {
            pauseTimer();
          } else {
            startTimer();
          }
        } else if (e.code === "KeyR") {
          e.preventDefault();
          resetTimer();
        }
      });

      // ë¸Œë¼ìš°ì € íƒ­ ì œëª© ì—…ë°ì´íŠ¸ (íƒ€ì´ë¨¸ ì§„í–‰ ìƒí™© í‘œì‹œ)
      function updatePageTitle() {
        if (isRunning) {
          document.title = `${formatTime(timeLeft)} - ${
            status.textContent
          } | ë½€ëª¨ë„ë¡œ`;
        } else {
          document.title = "ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸";
        }
      }

      // í˜ì´ì§€ ì œëª© ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ íƒ€ì´ë¨¸ ìˆ˜ì •
      const originalStartTimer = startTimer;
      startTimer = function () {
        originalStartTimer();

        // íƒ€ì´ë¨¸ ì‹¤í–‰ ì¤‘ í˜ì´ì§€ ì œëª© ì—…ë°ì´íŠ¸
        const titleUpdateInterval = setInterval(() => {
          if (isRunning) {
            updatePageTitle();
          } else {
            clearInterval(titleUpdateInterval);
            document.title = "ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸";
          }
        }, 1000);
      };

      // ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ (ì„ íƒì‚¬í•­)
      if ("Notification" in window && Notification.permission === "default") {
        Notification.requestPermission();
      }

      // ë¸Œë¼ìš°ì € ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
      function showBrowserNotification(title, body) {
        if ("Notification" in window && Notification.permission === "granted") {
          new Notification(title, {
            body: body,
            icon: "ğŸ…",
            tag: "pomodoro", // ê°™ì€ íƒœê·¸ì˜ ì•Œë¦¼ì€ í•˜ë‚˜ë§Œ í‘œì‹œ
          });
        }
      }

      // completeCurrentMode í•¨ìˆ˜ ìˆ˜ì • (ë¸Œë¼ìš°ì € ì•Œë¦¼ ì¶”ê°€)
      const originalCompleteCurrentMode = completeCurrentMode;
      completeCurrentMode = function () {
        pauseTimer();
        playNotificationSound();

        if (currentMode === "work") {
          completedCycles++;

          if (completedCycles % 4 === 0) {
            showBrowserNotification(
              "ë½€ëª¨ë„ë¡œ ì™„ë£Œ!",
              "4ë²ˆì§¸ ë½€ëª¨ë„ë¡œ ì™„ë£Œ! ê¸´ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”."
            );
            alert("ğŸ‰ 4ë²ˆì§¸ ë½€ëª¨ë„ë¡œ ì™„ë£Œ! ê¸´ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”.");
            switchMode("long-break");
          } else {
            showBrowserNotification("ë½€ëª¨ë„ë¡œ ì™„ë£Œ!", "ì§§ì€ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”.");
            alert("âœ… ë½€ëª¨ë„ë¡œ ì™„ë£Œ! ì§§ì€ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”.");
            switchMode("short-break");
          }
        } else {
          showBrowserNotification(
            "íœ´ì‹ ì™„ë£Œ!",
            "ìƒˆë¡œìš´ ë½€ëª¨ë„ë¡œë¥¼ ì‹œì‘í•˜ì„¸ìš”."
          );
          alert("â° íœ´ì‹ ì™„ë£Œ! ìƒˆë¡œìš´ ë½€ëª¨ë„ë¡œë¥¼ ì‹œì‘í•˜ì„¸ìš”.");
          switchMode("work");
        }

        updateDisplay();
      };

      // ì´ˆê¸° í™”ë©´ ì—…ë°ì´íŠ¸
      updateDisplay();

      // í˜ì´ì§€ ë¡œë“œ ì‹œ í™˜ì˜ ë©”ì‹œì§€
      setTimeout(() => {
        console.log("ğŸ… ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!");
        console.log(
          "ğŸ’¡ íŒ: ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì‹œì‘/ì¼ì‹œì •ì§€, Rí‚¤ë¡œ ë¦¬ì…‹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        );
      }, 500);
    </script>
  </body>
</html>
